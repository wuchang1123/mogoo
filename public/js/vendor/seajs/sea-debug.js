(function(global,undefined){"use strict";var _seajs=global.seajs;if(_seajs&&!_seajs.args){return}var seajs=global.seajs={version:"2.0.0b2"};function isType(type){return function(obj){return Object.prototype.toString.call(obj)==="[object "+type+"]"}}var isObject=isType("Object");var isArray=Array.isArray||isType("Array");var isFunction=isType("Function");var log=seajs.log=function(msg,type){global.console&&(type||configData.debug)&&console[type||(type="log")]&&console[type](msg)};var eventsCache=seajs.events={};seajs.on=function(event,callback){if(!callback)return seajs;var list=eventsCache[event]||(eventsCache[event]=[]);list.push(callback);return seajs};seajs.off=function(event,callback){if(!(event||callback)){seajs.events=eventsCache={};return seajs}var list=eventsCache[event];if(list){if(callback){for(var i=list.length-1;i>=0;i--){if(list[i]===callback){list.splice(i,1)}}}else{delete eventsCache[event]}}return seajs};var emit=seajs.emit=function(event,data){var list=eventsCache[event],fn;if(list){list=list.slice();while(fn=list.shift()){fn(data)}}return seajs};function emitData(event,data,prop){emit(event,data);return data[prop]}var DIRNAME_RE=/[^?]*(?=\/.*$)/;function dirname(path){var s=path.match(DIRNAME_RE);return(s?s[0]:".")+"/"}var DOT_RE=/\/\.\//g;var DOUBLE_DOT_RE=/\/[^/]+\/\.\.\//g;var MULTIPLE_SLASH_RE=/([^:\/])\/\/+/g;function realpath(path){path=path.replace(DOT_RE,"/");path=path.replace(MULTIPLE_SLASH_RE,"$1/");while(path.match(DOUBLE_DOT_RE)){path=path.replace(DOUBLE_DOT_RE,"/")}return path}var URI_END_RE=/\?|\.(?:css|js)$|\/$/;var HASH_END_RE=/#$/;function normalize(uri){uri=realpath(uri);if(HASH_END_RE.test(uri)){uri=uri.slice(0,-1)}else if(!URI_END_RE.test(uri)){uri+=".js"}uri=uri.replace(":80/","/");return uri}var VARS_RE=/{([^{}]+)}/g;function parseAlias(id){var alias=configData.alias;if(alias&&alias.hasOwnProperty(id)&&isTopLevel(id)){id=alias[id]}return id}function parseVars(id){var vars=configData.vars;if(vars&&id.indexOf("{")>=0){id=id.replace(VARS_RE,function(m,key){return vars.hasOwnProperty(key)?vars[key]:m})}return id}function parseMap(uri){var map=configData.map;var ret=uri;if(map){for(var i=0;i<map.length;i++){var rule=map[i];ret=isFunction(rule)?rule(uri)||uri:uri.replace(rule[0],rule[1]);if(ret!==uri)break}}return ret}var ROOT_DIR_RE=/^(.*?:\/\/.*?)(?:\/|$)/;function addBase(id,refUri){var ret;if(isAbsolute(id)){ret=id}else if(isRelative(id)){ret=(refUri?dirname(refUri):cwd)+id}else if(isRoot(id)){var m=(refUri||cwd).match(ROOT_DIR_RE);ret=(m?m[1]:"")+id}else{ret=configData.base+id}return ret}function id2Uri(id,refUri){if(!id)return"";id=parseAlias(id);id=parseVars(id);id=addBase(id,refUri);id=normalize(id);id=parseMap(id);return id}var ABSOLUTE_RE=/(?:^|:)\/\/./;var RELATIVE_RE=/^\.{1,2}\//;var ROOT_RE=/^\//;var TOPLEVEL_RE=/^[^./][^:]*$/;function isAbsolute(id){return ABSOLUTE_RE.test(id)}function isRelative(id){return RELATIVE_RE.test(id)}function isRoot(id){return ROOT_RE.test(id)}function isTopLevel(id){return TOPLEVEL_RE.test(id)}var doc=document;var loc=location;var cwd=dirname(loc.href);var loaderScript=doc.getElementById("seajsnode")||function(){var scripts=doc.getElementsByTagName("script");return scripts[scripts.length-1]}();var loaderDir=dirname(getScriptAbsoluteSrc(loaderScript))||cwd;function getScriptAbsoluteSrc(node){return node.hasAttribute?node.src:node.getAttribute("src",4)}seajs.cwd=function(val){return val?cwd=realpath(val+"/"):cwd};var head=doc.getElementsByTagName("head")[0]||doc.documentElement;var baseElement=head.getElementsByTagName("base")[0];var IS_CSS_RE=/\.css(?:\?|$)/i;var READY_STATE_RE=/^(?:loaded|complete|undefined)$/;var currentlyAddingScript;var interactiveScript;function request(url,callback,charset){var isCSS=IS_CSS_RE.test(url);var node=doc.createElement(isCSS?"link":"script");if(charset){var cs=isFunction(charset)?charset(url):charset;if(cs){node.charset=cs}}addOnload(node,callback,isCSS);if(isCSS){node.rel="stylesheet";node.href=url}else{node.async=true;node.src=url}currentlyAddingScript=node;baseElement?head.insertBefore(node,baseElement):head.appendChild(node);currentlyAddingScript=null}function addOnload(node,callback,isCSS){var missingOnload=isCSS&&(isOldWebKit||!("onload"in node));if(missingOnload){setTimeout(function(){pollCss(node,callback)},1);return}node.onload=node.onerror=node.onreadystatechange=function(){if(READY_STATE_RE.test(node.readyState)){node.onload=node.onerror=node.onreadystatechange=null;if(!isCSS&&!configData.debug){head.removeChild(node)}node=undefined;callback()}}}function pollCss(node,callback){var sheet=node.sheet;var isLoaded;if(isOldWebKit){if(sheet){isLoaded=true}}else if(sheet){try{if(sheet.cssRules){isLoaded=true}}catch(ex){if(ex.name==="NS_ERROR_DOM_SECURITY_ERR"){isLoaded=true}}}setTimeout(function(){if(isLoaded){callback()}else{pollCss(node,callback)}},20)}function getCurrentScript(){if(currentlyAddingScript){return currentlyAddingScript}if(interactiveScript&&interactiveScript.readyState==="interactive"){return interactiveScript}var scripts=head.getElementsByTagName("script");for(var i=scripts.length-1;i>=0;i--){var script=scripts[i];if(script.readyState==="interactive"){interactiveScript=script;return interactiveScript}}}var isOldWebKit=navigator.userAgent.replace(/.*AppleWebKit\/(\d+)\..*/,"$1")*1<536;var REQUIRE_RE=/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'|\/\*[\S\s]*?\*\/|\/(?:\\\/|[^/\r\n])+\/(?=[^\/])|\/\/.*|\.\s*require|(?:^|[^$])\brequire\s*\(\s*(["'])(.+?)\1\s*\)/g;var SLASH_RE=/\\\\/g;function parseDependencies(code){var ret=[];code.replace(SLASH_RE,"").replace(REQUIRE_RE,function(m,m1,m2){if(m2){ret.push(m2)}});return ret}var cachedModules=seajs.cache={};var STATUS=Module.STATUS={INITIALIZED:1,FETCHING:2,SAVED:3,LOADED:4,COMPILING:5,COMPILED:6};function Module(uri,status){this.uri=uri;this.status=status||STATUS.INITIALIZED;this.dependencies=[];this.waitings=[];emit("initialized",this)}Module.prototype.load=function(ids,callback){var uris=resolve(isArray(ids)?ids:[ids],this.uri);load(uris,function(){var exports=[];for(var i=0;i<uris.length;i++){exports[i]=compile(cachedModules[uris[i]])}if(callback){callback.apply(global,exports)}})};function resolve(ids,refUri){if(isArray(ids)){var ret=[];for(var i=0;i<ids.length;i++){ret[i]=resolve(ids[i],refUri)}return ret}var data={id:ids,refUri:refUri};var id=emitData("resolve",data,"id");return data.uri||id2Uri(id,refUri)}function load(uris,callback,options){options=options||{};var unloadedUris=options.filtered?uris:getUnloadedUris(uris);if(unloadedUris.length===0){callback();return}emit("load",unloadedUris);var len=unloadedUris.length;var remain=len;for(var i=0;i<len;i++){(function(uri){var mod=cachedModules[uri];var deps=mod.dependencies;mod.status<STATUS.SAVED?deps.length?mod.load(deps.splice(0,deps.length),function(){fetch(uri,onFetched)}):fetch(uri,onFetched):onFetched();function onFetched(){if(mod.status<STATUS.SAVED){done();return}if(isCircularWaiting(mod)){printCircularLog(circularStack);circularStack.length=0;done();return}var waitings=mod.waitings=getUnloadedUris(mod.dependencies);if(waitings.length===0){done(mod);return}load(waitings.slice(),function(){done(mod)},{filtered:true})}})(unloadedUris[i])}function done(mod){if(mod&&mod.status<STATUS.LOADED){mod.status=STATUS.LOADED}if(--remain===0){callback()}}}var fetchingList={};var fetchedList={};var callbackList={};var anonymousModuleMeta=null;function fetch(uri,callback){cachedModules[uri].status=STATUS.FETCHING;var requestUri=emitData("fetch",{uri:uri,fetchedList:fetchedList},"requestUri")||uri;if(fetchedList[requestUri]){callback();return}if(fetchingList[requestUri]){callbackList[requestUri].push(callback);return}fetchingList[requestUri]=true;callbackList[requestUri]=[callback];var charset=configData.charset;var data={uri:uri,requestUri:requestUri,callback:onRequested,charset:charset};var requested=emitData("request",data,"requested");if(!requested){request(data.requestUri,onRequested,charset)}function onRequested(){delete fetchingList[requestUri];fetchedList[requestUri]=true;if(anonymousModuleMeta){save(uri,anonymousModuleMeta);anonymousModuleMeta=null}var fn,fns=callbackList[requestUri];delete callbackList[requestUri];while(fn=fns.shift())fn()}}function define(id,deps,factory){var argsLen=arguments.length;if(argsLen===1){factory=id;id=undefined}else if(argsLen===2){factory=deps;deps=undefined;if(isArray(id)){deps=id;id=undefined}}if(!isArray(deps)&&isFunction(factory)){deps=parseDependencies(factory.toString())}var meta={id:id,dependencies:deps,factory:factory};var derivedUri;if(!id&&doc.attachEvent){var script=getCurrentScript();if(script){derivedUri=script.src}else{log("Failed to derive: "+factory)}}var resolvedUri=id?resolve(id):derivedUri;if(resolvedUri){save(resolvedUri,meta)}else{anonymousModuleMeta=meta}}function save(uri,meta){meta.uri=uri;uri=emitData("save",meta,"uri");var mod=getModule(uri);if(mod.status<STATUS.SAVED){mod.id=meta.id||uri;mod.dependencies=resolve(meta.dependencies||[],uri);mod.factory=meta.factory;mod.status=STATUS.SAVED}}function compile(mod){if(!mod){return null}if(mod.status>=STATUS.COMPILING){return mod.exports}emit("compile",mod);if(mod.status<STATUS.LOADED&&mod.exports===undefined){return null}mod.status=STATUS.COMPILING;function require(id){var child=cachedModules[require.resolve(id)];if(child===undefined){return null}child.parent=mod;return compile(child)}require.async=function(ids,callback){mod.load(ids,callback);return require};require.resolve=function(id){return resolve(id,mod.uri)};var factory=mod.factory;var exports=factory===undefined?mod.exports:factory;if(isFunction(factory)){exports=factory(require,mod.exports={},mod)}mod.exports=exports===undefined?mod.exports:exports;mod.status=STATUS.COMPILED;emit("compiled",mod);return mod.exports}function getModule(uri,status){return cachedModules[uri]||(cachedModules[uri]=new Module(uri,status))}function getUnloadedUris(uris){var ret=[];for(var i=0;i<uris.length;i++){var uri=uris[i];if(uri&&getModule(uri).status<STATUS.LOADED){ret.push(uri)}}return ret}var circularStack=[];function isCircularWaiting(mod){var waitings=mod.waitings;if(waitings.length===0){return false}circularStack.push(mod.uri);if(isOverlap(waitings,circularStack)){cutWaitings(waitings);return true}for(var i=0;i<waitings.length;i++){if(isCircularWaiting(cachedModules[waitings[i]])){return true}}circularStack.pop();return false}function isOverlap(arrA,arrB){for(var i=0;i<arrA.length;i++){for(var j=0;j<arrB.length;j++){if(arrB[j]===arrA[i]){return true}}}return false}function cutWaitings(waitings){var uri=circularStack[0];for(var i=waitings.length-1;i>=0;i--){if(waitings[i]===uri){waitings.splice(i,1);break}}}function printCircularLog(stack){stack.push(stack[0]);log("Circular dependencies: "+stack.join(" --> "))}function preload(callback){var preloadMods=configData.preload;var len=preloadMods.length;if(len){globalModule.load(preloadMods.splice(0,len),function(){preload(callback)})}else{callback()}}var globalModule=new Module(undefined,STATUS.COMPILED);seajs.use=function(ids,callback){preload(function(){globalModule.load(ids,callback)});return seajs};global.define=define;seajs.resolve=id2Uri;var configData=config.data={base:function(){var ret=loaderDir;var m=ret.match(/^(.+?\/)(?:seajs\/)+(?:\d[^/]+\/)?$/);if(m){ret=m[1]}return ret}(),charset:"utf-8",preload:[]};function config(data){for(var key in data){var curr=data[key];if(curr&&key==="plugins"){key="preload";curr=plugin2preload(curr)}var prev=configData[key];if(prev&&isObject(prev)){for(var k in curr){prev[k]=curr[k]}}else{if(isArray(prev)){curr=prev.concat(curr)}else if(key==="base"){curr=normalize(addBase(curr+"/"))}configData[key]=curr}}return seajs}seajs.config=config;function plugin2preload(arr){var ret=[],name;while(name=arr.shift()){ret.push(loaderDir+"plugin-"+name)}return ret}config({plugins:function(){var ret;var str=loc.search.replace(/(seajs-\w+)(&|$)/g,"$1=1$2");str+=" "+doc.cookie;str.replace(/seajs-(\w+)=1/g,function(m,name){(ret||(ret=[])).push(name)});return ret}()});var dataConfig=loaderScript.getAttribute("data-config");var dataMain=loaderScript.getAttribute("data-main");if(dataConfig){configData.preload.push(dataConfig)}if(dataMain){seajs.use(dataMain)}if(_seajs&&_seajs.args){var methods=["define","config","use","on"];var args=_seajs.args;for(var g=0;g<args.length;g+=2){seajs[methods[args[g]]].apply(seajs,args[g+1])}}})(this);